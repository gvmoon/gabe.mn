function setupAudioNodes(){javascriptNode=context.createScriptProcessor(2048,1,1),javascriptNode.connect(context.destination),analyser=context.createAnalyser(),analyser.smoothingTimeConstant=.4,analyser.fftSize=512,sourceNode=context.createBufferSource(),sourceNode.connect(analyser),analyser.connect(javascriptNode),sourceNode.connect(context.destination)}function loadSound(e){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=function(){context.decodeAudioData(o.response,function(e){playSound(e)},onError)},o.send()}function playSound(e){sourceNode.buffer=e,sourceNode.start(0)}function onError(e){console.log(e)}function drawSpectrum(e){for(var o=0;o<e.length;o++){var t=e[o];ctx.fillRect(6*o,325-t,3,325)}}window.AudioContext||(window.webkitAudioContext||alert("no audiocontext found"),window.AudioContext=window.webkitAudioContext);var context=new AudioContext,audioBuffer,sourceNode,analyser,javascriptNode,ctx=$("#canvas").get()[0].getContext("2d"),gradient=ctx.createLinearGradient(0,0,0,300);gradient.addColorStop(1,"#000000"),gradient.addColorStop(.75,"#000000"),gradient.addColorStop(.25,"#000000"),gradient.addColorStop(0,"#000000"),setupAudioNodes(),loadSound("../aud/deer.mp3"),javascriptNode.onaudioprocess=function(){var e=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(e),ctx.clearRect(0,0,400,325),ctx.fillStyle=gradient,drawSpectrum(e)};